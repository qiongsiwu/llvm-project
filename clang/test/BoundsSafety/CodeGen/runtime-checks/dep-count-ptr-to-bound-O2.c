// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py

// RUN: %clang_cc1 -O2 -triple x86_64 -fbounds-safety -Wno-bounds-safety-init-list -emit-llvm %s -o - | FileCheck --check-prefixes O2 %s
// RUN: %clang_cc1 -O2 -triple x86_64 -fbounds-safety -Wno-bounds-safety-init-list -x objective-c -fexperimental-bounds-safety-objc -emit-llvm %s -o - | FileCheck --check-prefixes O2 %s

#include <ptrcheck.h>

// O2-LABEL: @TestFail(
// O2-NEXT:  entry:
// O2-NEXT:    tail call void @llvm.ubsantrap(i8 25) #[[ATTR3:[0-9]+]], !annotation !{{.*}}
// O2-NEXT:    unreachable
//
int TestFail() {
    int len = 0;
    int i = 3;
    int *__single __counted_by(len) dcp = &i;
    int *bp = dcp;
    return *bp; // run-time trap : oob - dereference to zero-bound pointer
}



// O2-LABEL: @TestOK(
// O2-NEXT:  entry:
// O2-NEXT:    ret void
//
void TestOK() {
  int len = 0;
  int i = 3;
  int *__single __counted_by(len) dcp = &i;
  int *bp = dcp;
}
