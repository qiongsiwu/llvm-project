// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py UTC_ARGS: --replace-value-regex "!annotation ![0-9]+" "!tbaa ![0-9]+" "!tbaa\.struct ![0-9]+" "!nosanitize ![0-9]+" "!srcloc ![0-9]+" --prefix-filecheck-ir-name TMP_

// RUN: %clang_cc1 -O0 -triple x86_64 -fbounds-safety -emit-llvm %s -o - | FileCheck --check-prefix=CHECK-O0 %s
// RUN: %clang_cc1 -O0 -triple x86_64 -fbounds-safety -x objective-c -fexperimental-bounds-safety-objc -emit-llvm %s -o - | FileCheck --check-prefix=CHECK-O0 %s

#include <ptrcheck.h>

// CHECK-O0-LABEL: @diff_2d(
// CHECK-O0-NEXT:  entry:
// CHECK-O0-NEXT:    [[M_ADDR:%.*]] = alloca i32, align 4
// CHECK-O0-NEXT:    [[N_ADDR:%.*]] = alloca i32, align 4
// CHECK-O0-NEXT:    [[SAVED_STACK:%.*]] = alloca ptr, align 8
// CHECK-O0-NEXT:    [[__VLA_EXPR0:%.*]] = alloca i64, align 8
// CHECK-O0-NEXT:    [[__VLA_EXPR1:%.*]] = alloca i64, align 8
// CHECK-O0-NEXT:    [[AGG_TEMP:%.*]] = alloca %"__bounds_safety::wide_ptr.bidi_indexable", align 8
// CHECK-O0-NEXT:    [[AGG_TEMP1:%.*]] = alloca %"__bounds_safety::wide_ptr.bidi_indexable.0", align 8
// CHECK-O0-NEXT:    [[AGG_TEMP5:%.*]] = alloca %"__bounds_safety::wide_ptr.bidi_indexable", align 8
// CHECK-O0-NEXT:    [[AGG_TEMP6:%.*]] = alloca %"__bounds_safety::wide_ptr.bidi_indexable.0", align 8
// CHECK-O0-NEXT:    store i32 [[M:%.*]], ptr [[M_ADDR]], align 4
// CHECK-O0-NEXT:    store i32 [[N:%.*]], ptr [[N_ADDR]], align 4
// CHECK-O0-NEXT:    [[TMP0:%.*]] = load i32, ptr [[M_ADDR]], align 4
// CHECK-O0-NEXT:    [[TMP1:%.*]] = zext i32 [[TMP0]] to i64
// CHECK-O0-NEXT:    [[TMP2:%.*]] = load i32, ptr [[N_ADDR]], align 4
// CHECK-O0-NEXT:    [[TMP3:%.*]] = zext i32 [[TMP2]] to i64
// CHECK-O0-NEXT:    [[TMP4:%.*]] = call ptr @llvm.stacksave.p0()
// CHECK-O0-NEXT:    store ptr [[TMP4]], ptr [[SAVED_STACK]], align 8
// CHECK-O0-NEXT:    [[TMP5:%.*]] = mul nuw i64 [[TMP1]], [[TMP3]]
// CHECK-O0-NEXT:    [[VLA:%.*]] = alloca i32, i64 [[TMP5]], align 16
// CHECK-O0-NEXT:    store i64 [[TMP1]], ptr [[__VLA_EXPR0]], align 8
// CHECK-O0-NEXT:    store i64 [[TMP3]], ptr [[__VLA_EXPR1]], align 8
// CHECK-O0-NEXT:    [[TMP6:%.*]] = mul nuw i64 [[TMP1]], [[TMP3]]
// CHECK-O0-NEXT:    [[UPPER:%.*]] = getelementptr inbounds i32, ptr [[VLA]], i64 [[TMP6]]
// CHECK-O0-NEXT:    [[TMP7:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.0", ptr [[AGG_TEMP1]], i32 0, i32 0
// CHECK-O0-NEXT:    store ptr [[VLA]], ptr [[TMP7]], align 8
// CHECK-O0-NEXT:    [[TMP8:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.0", ptr [[AGG_TEMP1]], i32 0, i32 1
// CHECK-O0-NEXT:    store ptr [[UPPER]], ptr [[TMP8]], align 8
// CHECK-O0-NEXT:    [[TMP9:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.0", ptr [[AGG_TEMP1]], i32 0, i32 2
// CHECK-O0-NEXT:    store ptr [[VLA]], ptr [[TMP9]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR_ADDR:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.0", ptr [[AGG_TEMP1]], i32 0, i32 0
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR:%.*]] = load ptr, ptr [[WIDE_PTR_PTR_ADDR]], align 8
// CHECK-O0-NEXT:    [[TMP10:%.*]] = mul i64 1, [[TMP3]]
// CHECK-O0-NEXT:    [[TMP11:%.*]] = getelementptr i32, ptr [[WIDE_PTR_PTR]], i64 [[TMP10]]
// CHECK-O0-NEXT:    [[UPPER2:%.*]] = getelementptr inbounds i32, ptr [[TMP11]], i64 [[TMP3]]
// CHECK-O0-NEXT:    [[TMP12:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP]], i32 0, i32 0
// CHECK-O0-NEXT:    store ptr [[TMP11]], ptr [[TMP12]], align 8
// CHECK-O0-NEXT:    [[TMP13:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP]], i32 0, i32 1
// CHECK-O0-NEXT:    store ptr [[UPPER2]], ptr [[TMP13]], align 8
// CHECK-O0-NEXT:    [[TMP14:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP]], i32 0, i32 2
// CHECK-O0-NEXT:    store ptr [[TMP11]], ptr [[TMP14]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR_ADDR3:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP]], i32 0, i32 0
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR4:%.*]] = load ptr, ptr [[WIDE_PTR_PTR_ADDR3]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_UB_ADDR:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP]], i32 0, i32 1
// CHECK-O0-NEXT:    [[WIDE_PTR_UB:%.*]] = load ptr, ptr [[WIDE_PTR_UB_ADDR]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_LB_ADDR:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP]], i32 0, i32 2
// CHECK-O0-NEXT:    [[WIDE_PTR_LB:%.*]] = load ptr, ptr [[WIDE_PTR_LB_ADDR]], align 8
// CHECK-O0-NEXT:    [[TMP15:%.*]] = mul nuw i64 [[TMP1]], [[TMP3]]
// CHECK-O0-NEXT:    [[UPPER7:%.*]] = getelementptr inbounds i32, ptr [[VLA]], i64 [[TMP15]]
// CHECK-O0-NEXT:    [[TMP16:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.0", ptr [[AGG_TEMP6]], i32 0, i32 0
// CHECK-O0-NEXT:    store ptr [[VLA]], ptr [[TMP16]], align 8
// CHECK-O0-NEXT:    [[TMP17:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.0", ptr [[AGG_TEMP6]], i32 0, i32 1
// CHECK-O0-NEXT:    store ptr [[UPPER7]], ptr [[TMP17]], align 8
// CHECK-O0-NEXT:    [[TMP18:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.0", ptr [[AGG_TEMP6]], i32 0, i32 2
// CHECK-O0-NEXT:    store ptr [[VLA]], ptr [[TMP18]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR_ADDR8:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.0", ptr [[AGG_TEMP6]], i32 0, i32 0
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR9:%.*]] = load ptr, ptr [[WIDE_PTR_PTR_ADDR8]], align 8
// CHECK-O0-NEXT:    [[TMP19:%.*]] = mul i64 0, [[TMP3]]
// CHECK-O0-NEXT:    [[TMP20:%.*]] = getelementptr i32, ptr [[WIDE_PTR_PTR9]], i64 [[TMP19]]
// CHECK-O0-NEXT:    [[UPPER10:%.*]] = getelementptr inbounds i32, ptr [[TMP20]], i64 [[TMP3]]
// CHECK-O0-NEXT:    [[TMP21:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP5]], i32 0, i32 0
// CHECK-O0-NEXT:    store ptr [[TMP20]], ptr [[TMP21]], align 8
// CHECK-O0-NEXT:    [[TMP22:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP5]], i32 0, i32 1
// CHECK-O0-NEXT:    store ptr [[UPPER10]], ptr [[TMP22]], align 8
// CHECK-O0-NEXT:    [[TMP23:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP5]], i32 0, i32 2
// CHECK-O0-NEXT:    store ptr [[TMP20]], ptr [[TMP23]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR_ADDR11:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP5]], i32 0, i32 0
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR12:%.*]] = load ptr, ptr [[WIDE_PTR_PTR_ADDR11]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_UB_ADDR13:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP5]], i32 0, i32 1
// CHECK-O0-NEXT:    [[WIDE_PTR_UB14:%.*]] = load ptr, ptr [[WIDE_PTR_UB_ADDR13]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_LB_ADDR15:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP5]], i32 0, i32 2
// CHECK-O0-NEXT:    [[WIDE_PTR_LB16:%.*]] = load ptr, ptr [[WIDE_PTR_LB_ADDR15]], align 8
// CHECK-O0-NEXT:    [[SUB_PTR_LHS_CAST:%.*]] = ptrtoint ptr [[WIDE_PTR_PTR4]] to i64
// CHECK-O0-NEXT:    [[SUB_PTR_RHS_CAST:%.*]] = ptrtoint ptr [[WIDE_PTR_PTR12]] to i64
// CHECK-O0-NEXT:    [[SUB_PTR_SUB:%.*]] = sub i64 [[SUB_PTR_LHS_CAST]], [[SUB_PTR_RHS_CAST]]
// CHECK-O0-NEXT:    [[SUB_PTR_DIV:%.*]] = sdiv exact i64 [[SUB_PTR_SUB]], 4
// CHECK-O0-NEXT:    [[TMP24:%.*]] = load ptr, ptr [[SAVED_STACK]], align 8
// CHECK-O0-NEXT:    call void @llvm.stackrestore.p0(ptr [[TMP24]])
// CHECK-O0-NEXT:    ret i64 [[SUB_PTR_DIV]]
//
unsigned long long diff_2d(int m, int n) {
  int vla[m][n];
  return vla[1] - vla[0];
}

// CHECK-O0-LABEL: @diff_3d(
// CHECK-O0-NEXT:  entry:
// CHECK-O0-NEXT:    [[M_ADDR:%.*]] = alloca i32, align 4
// CHECK-O0-NEXT:    [[N_ADDR:%.*]] = alloca i32, align 4
// CHECK-O0-NEXT:    [[L_ADDR:%.*]] = alloca i32, align 4
// CHECK-O0-NEXT:    [[SAVED_STACK:%.*]] = alloca ptr, align 8
// CHECK-O0-NEXT:    [[__VLA_EXPR0:%.*]] = alloca i64, align 8
// CHECK-O0-NEXT:    [[__VLA_EXPR1:%.*]] = alloca i64, align 8
// CHECK-O0-NEXT:    [[AGG_TEMP:%.*]] = alloca %"__bounds_safety::wide_ptr.bidi_indexable.1", align 8
// CHECK-O0-NEXT:    [[AGG_TEMP1:%.*]] = alloca %"__bounds_safety::wide_ptr.bidi_indexable.2", align 8
// CHECK-O0-NEXT:    [[AGG_TEMP5:%.*]] = alloca %"__bounds_safety::wide_ptr.bidi_indexable.1", align 8
// CHECK-O0-NEXT:    [[AGG_TEMP6:%.*]] = alloca %"__bounds_safety::wide_ptr.bidi_indexable.2", align 8
// CHECK-O0-NEXT:    store i32 [[M:%.*]], ptr [[M_ADDR]], align 4
// CHECK-O0-NEXT:    store i32 [[N:%.*]], ptr [[N_ADDR]], align 4
// CHECK-O0-NEXT:    store i32 [[L:%.*]], ptr [[L_ADDR]], align 4
// CHECK-O0-NEXT:    [[TMP0:%.*]] = load i32, ptr [[M_ADDR]], align 4
// CHECK-O0-NEXT:    [[TMP1:%.*]] = zext i32 [[TMP0]] to i64
// CHECK-O0-NEXT:    [[TMP2:%.*]] = load i32, ptr [[N_ADDR]], align 4
// CHECK-O0-NEXT:    [[TMP3:%.*]] = zext i32 [[TMP2]] to i64
// CHECK-O0-NEXT:    [[TMP4:%.*]] = call ptr @llvm.stacksave.p0()
// CHECK-O0-NEXT:    store ptr [[TMP4]], ptr [[SAVED_STACK]], align 8
// CHECK-O0-NEXT:    [[TMP5:%.*]] = mul nuw i64 [[TMP1]], [[TMP3]]
// CHECK-O0-NEXT:    [[VLA:%.*]] = alloca [15 x i32], i64 [[TMP5]], align 16
// CHECK-O0-NEXT:    store i64 [[TMP1]], ptr [[__VLA_EXPR0]], align 8
// CHECK-O0-NEXT:    store i64 [[TMP3]], ptr [[__VLA_EXPR1]], align 8
// CHECK-O0-NEXT:    [[TMP6:%.*]] = mul nuw i64 [[TMP1]], [[TMP3]]
// CHECK-O0-NEXT:    [[UPPER:%.*]] = getelementptr inbounds [15 x i32], ptr [[VLA]], i64 [[TMP6]]
// CHECK-O0-NEXT:    [[TMP7:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.2", ptr [[AGG_TEMP1]], i32 0, i32 0
// CHECK-O0-NEXT:    store ptr [[VLA]], ptr [[TMP7]], align 8
// CHECK-O0-NEXT:    [[TMP8:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.2", ptr [[AGG_TEMP1]], i32 0, i32 1
// CHECK-O0-NEXT:    store ptr [[UPPER]], ptr [[TMP8]], align 8
// CHECK-O0-NEXT:    [[TMP9:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.2", ptr [[AGG_TEMP1]], i32 0, i32 2
// CHECK-O0-NEXT:    store ptr [[VLA]], ptr [[TMP9]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR_ADDR:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.2", ptr [[AGG_TEMP1]], i32 0, i32 0
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR:%.*]] = load ptr, ptr [[WIDE_PTR_PTR_ADDR]], align 8
// CHECK-O0-NEXT:    [[TMP10:%.*]] = mul i64 1, [[TMP3]]
// CHECK-O0-NEXT:    [[TMP11:%.*]] = getelementptr [15 x i32], ptr [[WIDE_PTR_PTR]], i64 [[TMP10]]
// CHECK-O0-NEXT:    [[UPPER2:%.*]] = getelementptr inbounds [15 x i32], ptr [[TMP11]], i64 [[TMP3]]
// CHECK-O0-NEXT:    [[TMP12:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.1", ptr [[AGG_TEMP]], i32 0, i32 0
// CHECK-O0-NEXT:    store ptr [[TMP11]], ptr [[TMP12]], align 8
// CHECK-O0-NEXT:    [[TMP13:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.1", ptr [[AGG_TEMP]], i32 0, i32 1
// CHECK-O0-NEXT:    store ptr [[UPPER2]], ptr [[TMP13]], align 8
// CHECK-O0-NEXT:    [[TMP14:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.1", ptr [[AGG_TEMP]], i32 0, i32 2
// CHECK-O0-NEXT:    store ptr [[TMP11]], ptr [[TMP14]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR_ADDR3:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.1", ptr [[AGG_TEMP]], i32 0, i32 0
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR4:%.*]] = load ptr, ptr [[WIDE_PTR_PTR_ADDR3]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_UB_ADDR:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.1", ptr [[AGG_TEMP]], i32 0, i32 1
// CHECK-O0-NEXT:    [[WIDE_PTR_UB:%.*]] = load ptr, ptr [[WIDE_PTR_UB_ADDR]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_LB_ADDR:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.1", ptr [[AGG_TEMP]], i32 0, i32 2
// CHECK-O0-NEXT:    [[WIDE_PTR_LB:%.*]] = load ptr, ptr [[WIDE_PTR_LB_ADDR]], align 8
// CHECK-O0-NEXT:    [[TMP15:%.*]] = mul nuw i64 [[TMP1]], [[TMP3]]
// CHECK-O0-NEXT:    [[UPPER7:%.*]] = getelementptr inbounds [15 x i32], ptr [[VLA]], i64 [[TMP15]]
// CHECK-O0-NEXT:    [[TMP16:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.2", ptr [[AGG_TEMP6]], i32 0, i32 0
// CHECK-O0-NEXT:    store ptr [[VLA]], ptr [[TMP16]], align 8
// CHECK-O0-NEXT:    [[TMP17:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.2", ptr [[AGG_TEMP6]], i32 0, i32 1
// CHECK-O0-NEXT:    store ptr [[UPPER7]], ptr [[TMP17]], align 8
// CHECK-O0-NEXT:    [[TMP18:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.2", ptr [[AGG_TEMP6]], i32 0, i32 2
// CHECK-O0-NEXT:    store ptr [[VLA]], ptr [[TMP18]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR_ADDR8:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.2", ptr [[AGG_TEMP6]], i32 0, i32 0
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR9:%.*]] = load ptr, ptr [[WIDE_PTR_PTR_ADDR8]], align 8
// CHECK-O0-NEXT:    [[TMP19:%.*]] = mul i64 0, [[TMP3]]
// CHECK-O0-NEXT:    [[TMP20:%.*]] = getelementptr [15 x i32], ptr [[WIDE_PTR_PTR9]], i64 [[TMP19]]
// CHECK-O0-NEXT:    [[UPPER10:%.*]] = getelementptr inbounds [15 x i32], ptr [[TMP20]], i64 [[TMP3]]
// CHECK-O0-NEXT:    [[TMP21:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.1", ptr [[AGG_TEMP5]], i32 0, i32 0
// CHECK-O0-NEXT:    store ptr [[TMP20]], ptr [[TMP21]], align 8
// CHECK-O0-NEXT:    [[TMP22:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.1", ptr [[AGG_TEMP5]], i32 0, i32 1
// CHECK-O0-NEXT:    store ptr [[UPPER10]], ptr [[TMP22]], align 8
// CHECK-O0-NEXT:    [[TMP23:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.1", ptr [[AGG_TEMP5]], i32 0, i32 2
// CHECK-O0-NEXT:    store ptr [[TMP20]], ptr [[TMP23]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR_ADDR11:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.1", ptr [[AGG_TEMP5]], i32 0, i32 0
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR12:%.*]] = load ptr, ptr [[WIDE_PTR_PTR_ADDR11]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_UB_ADDR13:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.1", ptr [[AGG_TEMP5]], i32 0, i32 1
// CHECK-O0-NEXT:    [[WIDE_PTR_UB14:%.*]] = load ptr, ptr [[WIDE_PTR_UB_ADDR13]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_LB_ADDR15:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.1", ptr [[AGG_TEMP5]], i32 0, i32 2
// CHECK-O0-NEXT:    [[WIDE_PTR_LB16:%.*]] = load ptr, ptr [[WIDE_PTR_LB_ADDR15]], align 8
// CHECK-O0-NEXT:    [[SUB_PTR_LHS_CAST:%.*]] = ptrtoint ptr [[WIDE_PTR_PTR4]] to i64
// CHECK-O0-NEXT:    [[SUB_PTR_RHS_CAST:%.*]] = ptrtoint ptr [[WIDE_PTR_PTR12]] to i64
// CHECK-O0-NEXT:    [[SUB_PTR_SUB:%.*]] = sub i64 [[SUB_PTR_LHS_CAST]], [[SUB_PTR_RHS_CAST]]
// CHECK-O0-NEXT:    [[SUB_PTR_DIV:%.*]] = sdiv exact i64 [[SUB_PTR_SUB]], 60
// CHECK-O0-NEXT:    [[TMP24:%.*]] = load ptr, ptr [[SAVED_STACK]], align 8
// CHECK-O0-NEXT:    call void @llvm.stackrestore.p0(ptr [[TMP24]])
// CHECK-O0-NEXT:    ret i64 [[SUB_PTR_DIV]]
//
unsigned long long diff_3d(int m, int n, int l) {
  int vla[m][n][15];
  return vla[1] - vla[0];
}


// CHECK-O0-LABEL: @diff_3d_2(
// CHECK-O0-NEXT:  entry:
// CHECK-O0-NEXT:    [[M_ADDR:%.*]] = alloca i32, align 4
// CHECK-O0-NEXT:    [[N_ADDR:%.*]] = alloca i32, align 4
// CHECK-O0-NEXT:    [[L_ADDR:%.*]] = alloca i32, align 4
// CHECK-O0-NEXT:    [[SAVED_STACK:%.*]] = alloca ptr, align 8
// CHECK-O0-NEXT:    [[__VLA_EXPR0:%.*]] = alloca i64, align 8
// CHECK-O0-NEXT:    [[__VLA_EXPR1:%.*]] = alloca i64, align 8
// CHECK-O0-NEXT:    [[__VLA_EXPR2:%.*]] = alloca i64, align 8
// CHECK-O0-NEXT:    [[AGG_TEMP:%.*]] = alloca %"__bounds_safety::wide_ptr.bidi_indexable", align 8
// CHECK-O0-NEXT:    [[AGG_TEMP1:%.*]] = alloca %"__bounds_safety::wide_ptr.bidi_indexable.3", align 8
// CHECK-O0-NEXT:    [[AGG_TEMP2:%.*]] = alloca %"__bounds_safety::wide_ptr.bidi_indexable.4", align 8
// CHECK-O0-NEXT:    [[AGG_TEMP9:%.*]] = alloca %"__bounds_safety::wide_ptr.bidi_indexable", align 8
// CHECK-O0-NEXT:    [[AGG_TEMP10:%.*]] = alloca %"__bounds_safety::wide_ptr.bidi_indexable.3", align 8
// CHECK-O0-NEXT:    [[AGG_TEMP11:%.*]] = alloca %"__bounds_safety::wide_ptr.bidi_indexable.4", align 8
// CHECK-O0-NEXT:    store i32 [[M:%.*]], ptr [[M_ADDR]], align 4
// CHECK-O0-NEXT:    store i32 [[N:%.*]], ptr [[N_ADDR]], align 4
// CHECK-O0-NEXT:    store i32 [[L:%.*]], ptr [[L_ADDR]], align 4
// CHECK-O0-NEXT:    [[TMP0:%.*]] = load i32, ptr [[M_ADDR]], align 4
// CHECK-O0-NEXT:    [[TMP1:%.*]] = zext i32 [[TMP0]] to i64
// CHECK-O0-NEXT:    [[TMP2:%.*]] = load i32, ptr [[N_ADDR]], align 4
// CHECK-O0-NEXT:    [[TMP3:%.*]] = zext i32 [[TMP2]] to i64
// CHECK-O0-NEXT:    [[TMP4:%.*]] = load i32, ptr [[L_ADDR]], align 4
// CHECK-O0-NEXT:    [[TMP5:%.*]] = zext i32 [[TMP4]] to i64
// CHECK-O0-NEXT:    [[TMP6:%.*]] = call ptr @llvm.stacksave.p0()
// CHECK-O0-NEXT:    store ptr [[TMP6]], ptr [[SAVED_STACK]], align 8
// CHECK-O0-NEXT:    [[TMP7:%.*]] = mul nuw i64 [[TMP1]], [[TMP3]]
// CHECK-O0-NEXT:    [[TMP8:%.*]] = mul nuw i64 [[TMP7]], [[TMP5]]
// CHECK-O0-NEXT:    [[VLA:%.*]] = alloca i32, i64 [[TMP8]], align 16
// CHECK-O0-NEXT:    store i64 [[TMP1]], ptr [[__VLA_EXPR0]], align 8
// CHECK-O0-NEXT:    store i64 [[TMP3]], ptr [[__VLA_EXPR1]], align 8
// CHECK-O0-NEXT:    store i64 [[TMP5]], ptr [[__VLA_EXPR2]], align 8
// CHECK-O0-NEXT:    [[TMP9:%.*]] = mul nuw i64 [[TMP1]], [[TMP3]]
// CHECK-O0-NEXT:    [[TMP10:%.*]] = mul nuw i64 [[TMP9]], [[TMP5]]
// CHECK-O0-NEXT:    [[UPPER:%.*]] = getelementptr inbounds i32, ptr [[VLA]], i64 [[TMP10]]
// CHECK-O0-NEXT:    [[TMP11:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.4", ptr [[AGG_TEMP2]], i32 0, i32 0
// CHECK-O0-NEXT:    store ptr [[VLA]], ptr [[TMP11]], align 8
// CHECK-O0-NEXT:    [[TMP12:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.4", ptr [[AGG_TEMP2]], i32 0, i32 1
// CHECK-O0-NEXT:    store ptr [[UPPER]], ptr [[TMP12]], align 8
// CHECK-O0-NEXT:    [[TMP13:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.4", ptr [[AGG_TEMP2]], i32 0, i32 2
// CHECK-O0-NEXT:    store ptr [[VLA]], ptr [[TMP13]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR_ADDR:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.4", ptr [[AGG_TEMP2]], i32 0, i32 0
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR:%.*]] = load ptr, ptr [[WIDE_PTR_PTR_ADDR]], align 8
// CHECK-O0-NEXT:    [[TMP14:%.*]] = mul nuw i64 [[TMP3]], [[TMP5]]
// CHECK-O0-NEXT:    [[TMP15:%.*]] = mul i64 0, [[TMP14]]
// CHECK-O0-NEXT:    [[TMP16:%.*]] = getelementptr i32, ptr [[WIDE_PTR_PTR]], i64 [[TMP15]]
// CHECK-O0-NEXT:    [[TMP17:%.*]] = mul nuw i64 [[TMP3]], [[TMP5]]
// CHECK-O0-NEXT:    [[UPPER3:%.*]] = getelementptr inbounds i32, ptr [[TMP16]], i64 [[TMP17]]
// CHECK-O0-NEXT:    [[TMP18:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.3", ptr [[AGG_TEMP1]], i32 0, i32 0
// CHECK-O0-NEXT:    store ptr [[TMP16]], ptr [[TMP18]], align 8
// CHECK-O0-NEXT:    [[TMP19:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.3", ptr [[AGG_TEMP1]], i32 0, i32 1
// CHECK-O0-NEXT:    store ptr [[UPPER3]], ptr [[TMP19]], align 8
// CHECK-O0-NEXT:    [[TMP20:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.3", ptr [[AGG_TEMP1]], i32 0, i32 2
// CHECK-O0-NEXT:    store ptr [[TMP16]], ptr [[TMP20]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR_ADDR4:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.3", ptr [[AGG_TEMP1]], i32 0, i32 0
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR5:%.*]] = load ptr, ptr [[WIDE_PTR_PTR_ADDR4]], align 8
// CHECK-O0-NEXT:    [[TMP21:%.*]] = mul i64 1, [[TMP5]]
// CHECK-O0-NEXT:    [[TMP22:%.*]] = getelementptr i32, ptr [[WIDE_PTR_PTR5]], i64 [[TMP21]]
// CHECK-O0-NEXT:    [[UPPER6:%.*]] = getelementptr inbounds i32, ptr [[TMP22]], i64 [[TMP5]]
// CHECK-O0-NEXT:    [[TMP23:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP]], i32 0, i32 0
// CHECK-O0-NEXT:    store ptr [[TMP22]], ptr [[TMP23]], align 8
// CHECK-O0-NEXT:    [[TMP24:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP]], i32 0, i32 1
// CHECK-O0-NEXT:    store ptr [[UPPER6]], ptr [[TMP24]], align 8
// CHECK-O0-NEXT:    [[TMP25:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP]], i32 0, i32 2
// CHECK-O0-NEXT:    store ptr [[TMP22]], ptr [[TMP25]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR_ADDR7:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP]], i32 0, i32 0
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR8:%.*]] = load ptr, ptr [[WIDE_PTR_PTR_ADDR7]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_UB_ADDR:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP]], i32 0, i32 1
// CHECK-O0-NEXT:    [[WIDE_PTR_UB:%.*]] = load ptr, ptr [[WIDE_PTR_UB_ADDR]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_LB_ADDR:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP]], i32 0, i32 2
// CHECK-O0-NEXT:    [[WIDE_PTR_LB:%.*]] = load ptr, ptr [[WIDE_PTR_LB_ADDR]], align 8
// CHECK-O0-NEXT:    [[TMP26:%.*]] = mul nuw i64 [[TMP1]], [[TMP3]]
// CHECK-O0-NEXT:    [[TMP27:%.*]] = mul nuw i64 [[TMP26]], [[TMP5]]
// CHECK-O0-NEXT:    [[UPPER12:%.*]] = getelementptr inbounds i32, ptr [[VLA]], i64 [[TMP27]]
// CHECK-O0-NEXT:    [[TMP28:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.4", ptr [[AGG_TEMP11]], i32 0, i32 0
// CHECK-O0-NEXT:    store ptr [[VLA]], ptr [[TMP28]], align 8
// CHECK-O0-NEXT:    [[TMP29:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.4", ptr [[AGG_TEMP11]], i32 0, i32 1
// CHECK-O0-NEXT:    store ptr [[UPPER12]], ptr [[TMP29]], align 8
// CHECK-O0-NEXT:    [[TMP30:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.4", ptr [[AGG_TEMP11]], i32 0, i32 2
// CHECK-O0-NEXT:    store ptr [[VLA]], ptr [[TMP30]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR_ADDR13:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.4", ptr [[AGG_TEMP11]], i32 0, i32 0
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR14:%.*]] = load ptr, ptr [[WIDE_PTR_PTR_ADDR13]], align 8
// CHECK-O0-NEXT:    [[TMP31:%.*]] = mul nuw i64 [[TMP3]], [[TMP5]]
// CHECK-O0-NEXT:    [[TMP32:%.*]] = mul i64 0, [[TMP31]]
// CHECK-O0-NEXT:    [[TMP33:%.*]] = getelementptr i32, ptr [[WIDE_PTR_PTR14]], i64 [[TMP32]]
// CHECK-O0-NEXT:    [[TMP34:%.*]] = mul nuw i64 [[TMP3]], [[TMP5]]
// CHECK-O0-NEXT:    [[UPPER15:%.*]] = getelementptr inbounds i32, ptr [[TMP33]], i64 [[TMP34]]
// CHECK-O0-NEXT:    [[TMP35:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.3", ptr [[AGG_TEMP10]], i32 0, i32 0
// CHECK-O0-NEXT:    store ptr [[TMP33]], ptr [[TMP35]], align 8
// CHECK-O0-NEXT:    [[TMP36:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.3", ptr [[AGG_TEMP10]], i32 0, i32 1
// CHECK-O0-NEXT:    store ptr [[UPPER15]], ptr [[TMP36]], align 8
// CHECK-O0-NEXT:    [[TMP37:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.3", ptr [[AGG_TEMP10]], i32 0, i32 2
// CHECK-O0-NEXT:    store ptr [[TMP33]], ptr [[TMP37]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR_ADDR16:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable.3", ptr [[AGG_TEMP10]], i32 0, i32 0
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR17:%.*]] = load ptr, ptr [[WIDE_PTR_PTR_ADDR16]], align 8
// CHECK-O0-NEXT:    [[TMP38:%.*]] = mul i64 0, [[TMP5]]
// CHECK-O0-NEXT:    [[TMP39:%.*]] = getelementptr i32, ptr [[WIDE_PTR_PTR17]], i64 [[TMP38]]
// CHECK-O0-NEXT:    [[UPPER18:%.*]] = getelementptr inbounds i32, ptr [[TMP39]], i64 [[TMP5]]
// CHECK-O0-NEXT:    [[TMP40:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP9]], i32 0, i32 0
// CHECK-O0-NEXT:    store ptr [[TMP39]], ptr [[TMP40]], align 8
// CHECK-O0-NEXT:    [[TMP41:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP9]], i32 0, i32 1
// CHECK-O0-NEXT:    store ptr [[UPPER18]], ptr [[TMP41]], align 8
// CHECK-O0-NEXT:    [[TMP42:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP9]], i32 0, i32 2
// CHECK-O0-NEXT:    store ptr [[TMP39]], ptr [[TMP42]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR_ADDR19:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP9]], i32 0, i32 0
// CHECK-O0-NEXT:    [[WIDE_PTR_PTR20:%.*]] = load ptr, ptr [[WIDE_PTR_PTR_ADDR19]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_UB_ADDR21:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP9]], i32 0, i32 1
// CHECK-O0-NEXT:    [[WIDE_PTR_UB22:%.*]] = load ptr, ptr [[WIDE_PTR_UB_ADDR21]], align 8
// CHECK-O0-NEXT:    [[WIDE_PTR_LB_ADDR23:%.*]] = getelementptr inbounds %"__bounds_safety::wide_ptr.bidi_indexable", ptr [[AGG_TEMP9]], i32 0, i32 2
// CHECK-O0-NEXT:    [[WIDE_PTR_LB24:%.*]] = load ptr, ptr [[WIDE_PTR_LB_ADDR23]], align 8
// CHECK-O0-NEXT:    [[SUB_PTR_LHS_CAST:%.*]] = ptrtoint ptr [[WIDE_PTR_PTR8]] to i64
// CHECK-O0-NEXT:    [[SUB_PTR_RHS_CAST:%.*]] = ptrtoint ptr [[WIDE_PTR_PTR20]] to i64
// CHECK-O0-NEXT:    [[SUB_PTR_SUB:%.*]] = sub i64 [[SUB_PTR_LHS_CAST]], [[SUB_PTR_RHS_CAST]]
// CHECK-O0-NEXT:    [[SUB_PTR_DIV:%.*]] = sdiv exact i64 [[SUB_PTR_SUB]], 4
// CHECK-O0-NEXT:    [[TMP43:%.*]] = load ptr, ptr [[SAVED_STACK]], align 8
// CHECK-O0-NEXT:    call void @llvm.stackrestore.p0(ptr [[TMP43]])
// CHECK-O0-NEXT:    ret i64 [[SUB_PTR_DIV]]
//
unsigned long long diff_3d_2(int m, int n, int l) {
  int vla[m][n][l];
  return vla[0][1] - vla[0][0];
}
