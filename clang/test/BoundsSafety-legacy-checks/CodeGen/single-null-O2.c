// NOTE: Assertions have been autogenerated by utils/update_cc_test_checks.py

// RUN: %clang_cc1 -O2 -triple x86_64 -fbounds-safety -emit-llvm %s -o - | FileCheck %s --check-prefix=CHECK-O2
// RUN: %clang_cc1 -O2 -triple x86_64 -fbounds-safety -x objective-c -fbounds-attributes-objc-experimental -emit-llvm %s -o - | FileCheck %s --check-prefix=CHECK-O2

#include <ptrcheck.h>

// CHECK-O2-LABEL: @TestOK(
// CHECK-O2-NEXT:  entry:
// CHECK-O2-NEXT:    ret i32 0
//
int TestOK() {
    int len = 0;
    int *__single __counted_by(len) dcp = 0;
    int *__single tp = dcp;
    return 0;
}

// FIXME
// CHECK-O2-LABEL: @TestTrap(
// CHECK-O2-NEXT:  entry:
// CHECK-O2-NEXT:    ret void
//
void TestTrap() {
  int len = 1;
  char p;
  char *__counted_by(len) dcp = &p;
  int *__single tp = dcp; // rdar://80816535
}
